<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Andyçš„å†’é™©èƒŒåŒ…</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }
        body { 
            background-color: #76b5fe; font-family: 'VT323', monospace; 
            text-align: center; margin: 0; padding: 0; overflow: hidden; height: 100vh; 
            display: flex; flex-direction: column; align-items: center; 
            transition: background-color 2s ease; 
        }
        
        /* ------------------- åœºæ™¯ä¸èƒŒæ™¯ ------------------- */
        .stars { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-image: radial-gradient(white 1px, transparent 1px); background-size: 50px 50px; opacity: 0; transition: opacity 2s; z-index: 0; pointer-events: none; }
        body.night .stars { opacity: 0.5; } 
        body.night { background-color: #1a0b2e; }
        
        .ground { position: absolute; bottom: 0; width: 100%; height: 60px; background: #5D4037; border-top: 10px solid #4CAF50; z-index: 10; }

        /* ------------------- UI ç•Œé¢ ------------------- */
        .ui-container { margin-top: 8vh; width: 90%; max-width: 400px; z-index: 100; position: relative; transition: opacity 0.3s;}
        .card { background-color: #c6c6c6; border: 4px solid #000; box-shadow: inset 4px 4px #fff, inset -4px -4px #555; padding: 20px; position: relative; }
        h2 { color: #404040; margin: 0 0 5px 0; font-size: 32px; text-shadow: 2px 2px #fff; letter-spacing: 2px; }
        
        .rank-badge { background: #333; color: #f1c40f; padding: 2px 10px; border: 2px solid #fff; display: inline-block; margin-bottom: 15px; font-size: 18px; border-radius: 4px; }
        
        .slot { background: #8b8b8b; width: 120px; height: 120px; margin: 0 auto; border: 4px solid #373737; border-right-color: #fff; border-bottom-color: #fff; display: flex; align-items: center; justify-content: center; position: relative; cursor: pointer; }
        .slot:active .coin-icon { transform: scale(0.8); }
        .coin-icon { font-size: 70px; filter: drop-shadow(4px 4px 0px rgba(0,0,0,0.5)); z-index: 2; transition: transform 0.1s;}
        
        .label { color: #404040; font-size: 20px; margin-top: 15px; font-weight: bold; text-shadow: 1px 1px #fff;}
        .total { font-size: 80px; color: #fff; font-weight: bold; text-shadow: 4px 4px 0px #333; margin: 5px 0; line-height: 1; }
        
        .status-bar { background: #000; color: #fff; padding: 5px 10px; border-radius: 4px; font-size: 14px; display: inline-flex; align-items: center; margin-top: 10px; border: 2px solid #555; }
        .light { width: 8px; height: 8px; background: #e74c3c; margin-right: 8px; }
        .light.online { background: #2ecc71; box-shadow: 0 0 5px #2ecc71; }
        .message { color: #004400; margin-top: 10px; font-size: 18px; height: 24px; text-shadow: 1px 1px #fff; font-weight: bold;}
        .mute-btn { position: absolute; top: 10px; right: 10px; font-size: 24px; cursor: pointer; color: #555; }

        /* ------------------- è§’è‰²ç³»ç»Ÿ ------------------- */
        .stage { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 50; overflow: hidden;}
        
        /* å²è’‚å¤« */
        .actor-steve { position: absolute; bottom: 50px; left: -100px; width: 60px; height: 135px; transition: transform 0.1s; z-index: 60;}
        .s-head { width: 60px; height: 60px; background: #F8B090; position: absolute; top: 0; z-index: 2;}
        .s-hair { width: 60px; height: 15px; background: #452613; position: absolute; top: 0; z-index: 3;}
        .s-body { width: 60px; height: 45px; background: #00AAAA; position: absolute; top: 60px; z-index: 1;}
        .s-pants { width: 60px; height: 30px; background: #303090; position: absolute; top: 105px; }
        
        /* âš”ï¸ å®Œç¾ä¿®å¤çš„æ­¦å™¨ï¼šé’»çŸ³å‰‘ */
        .s-sword { 
            position: absolute; 
            /* è°ƒæ•´ä½ç½®ï¼Œè®©å‰‘æŸ„å¯¹å‡†æ‰‹éƒ¨ */
            top: 35px; right: -40px; 
            font-size: 60px; 
            /* å…³é”®1ï¼šscaleX(-1) æ°´å¹³ç¿»è½¬ï¼Œè§£å†³æ‹¿åçš„é—®é¢˜ */
            /* å…³é”®2ï¼šrotate(45deg) è°ƒæ•´åˆå§‹è§’åº¦ä¸ºæ–œå‘ä¸ŠæŒå‰‘ */
            transform: scaleX(-1) rotate(45deg); 
            /* å…³é”®3ï¼šæ—‹è½¬ä¸­å¿ƒè®¾ä¸ºå·¦ä¸‹è§’ï¼ˆç¿»è½¬åçš„å‰‘æŸ„ä½ç½®ï¼‰ */
            transform-origin: 20% 80%; 
            z-index: 4; 
            display: none; 
            filter: drop-shadow(2px 2px 0 #000);
        }
        
        /* è‹¦åŠ›æ€• */
        .actor-creeper { position: absolute; bottom: 50px; right: -100px; width: 45px; height: 120px; transition: filter 0.1s; z-index: 55;}
        .c-head { width: 45px; height: 45px; background: #00AA00; position: absolute; top: 0; border: 3px solid #005500; }
        .c-face { position: absolute; top: 10px; left: 8px; width: 29px; height: 25px; background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 8 8"><path d="M1 1h2v2h2v-2h2v3h-2v1h1v2h-2v-1h-2v1h-2v-2h1v-1h-2z"/></svg>'); opacity: 0.8;}
        .c-body { width: 45px; height: 45px; background: #00AA00; position: absolute; top: 45px; }
        .c-legs { width: 45px; height: 30px; position: absolute; top: 90px; }
        .c-leg { width: 15px; height: 30px; background: #00AA00; position: absolute; bottom:0;}

        /* å°çŒª */
        .actor-pig { position: absolute; bottom: 50px; left: -80px; width: 50px; height: 30px; z-index: 52; animation: walkAcross 20s linear infinite; animation-delay: 2s; }
        .p-head { width: 20px; height: 20px; background: #F0A5A5; position: absolute; left: 0; top: 0; }
        .p-nose { width: 8px; height: 6px; background: #D16D6D; position: absolute; left: -4px; top: 8px; }
        .p-body { width: 35px; height: 20px; background: #F0A5A5; position: absolute; left: 15px; top: 5px; }
        .p-leg { width: 8px; height: 10px; background: #D16D6D; position: absolute; top: 20px; }
        
        /* åƒµå°¸ */
        .actor-zombie { position: absolute; bottom: 50px; right: -80px; width: 45px; height: 120px; z-index: 53; animation: walkAcrossReverse 25s linear infinite; animation-delay: 10s; display: none; }
        .z-head { width: 45px; height: 45px; background: #00A080; position: absolute; top: 0; }
        .z-body { width: 45px; height: 45px; background: #008080; position: absolute; top: 45px; }
        .z-arms { width: 45px; height: 12px; background: #00A080; position: absolute; top: 50px; left: -20px; box-shadow: 20px 0 #00A080; }
        .z-legs { width: 45px; height: 30px; position: absolute; top: 90px; }
        .z-leg { width: 20px; height: 30px; background: #303090; position: absolute; bottom:0; }

        /* ------------------- åŠ¨ç”» ------------------- */
        .breathe { animation: breathe 2s ease-in-out infinite; }
        @keyframes breathe { 0%, 100% { transform: scaleY(1); } 50% { transform: scaleY(1.02); } }
        
        .patrol { animation: patrol 15s linear infinite; }
        @keyframes patrol { 
            0% { right: -60px; transform: scaleX(1); } 
            45% { right: 110%; transform: scaleX(1); } 
            50% { right: 110%; transform: scaleX(-1); } 
            95% { right: -60px; transform: scaleX(-1); } 
            100% { right: -60px; transform: scaleX(1); } 
        }

        @keyframes walkAcross { 0% { left: -100px; } 100% { left: 120%; } }
        @keyframes walkAcrossReverse { 0% { right: -100px; } 100% { right: 120%; } }

        /* âš”ï¸ ä¼˜åŒ–åçš„æŒ¥ç åŠ¨ç”»ï¼šå¸¦æ°´å¹³ç¿»è½¬çš„æ—‹è½¬ */
        .anim-attack { animation: swordSwing 0.35s ease-out forwards; }
        @keyframes swordSwing { 
            /* æ³¨æ„ï¼šscaleX(-1) å¿…é¡»å…¨ç¨‹ä¿ç•™ï¼Œå¦åˆ™å‰‘ä¼šç¬é—´ç¿»é¢ */
            0% { transform: scaleX(-1) rotate(45deg); } 
            50% { transform: scaleX(-1) rotate(-60deg); } /* å‘ä¸‹çŒ›ç  */
            100% { transform: scaleX(-1) rotate(45deg); } /* æ”¶åˆ€ */
        }
        
        .anim-hurt { animation: hurtFlash 0.3s steps(2) infinite; }
        @keyframes hurtFlash { 0% { filter: sepia(1) hue-rotate(-50deg) saturate(5); } 100% { filter: none; } }

        .anim-swell { animation: swell 2.5s ease-in forwards; }
        @keyframes swell { 
            0% { transform: scale(1); filter: brightness(1); } 
            20% { transform: scale(1.1); filter: brightness(1.2); }
            40% { transform: scale(1); filter: brightness(1); }
            60% { transform: scale(1.3); filter: brightness(1.5); }
            80% { transform: scale(1.1); filter: brightness(1); }
            95% { transform: scale(2.5); filter: brightness(100); opacity: 1;}
            100% { transform: scale(3); opacity: 0; }
        }

        .shake { animation: shake 0.5s; }
        @keyframes shake { 0% { transform: translate(1px, 1px) rotate(0deg); } 10% { transform: translate(-1px, -2px) rotate(-1deg); } 20% { transform: translate(-3px, 0px) rotate(1deg); } 30% { transform: translate(3px, 2px) rotate(0deg); } 40% { transform: translate(1px, -1px) rotate(1deg); } 50% { transform: translate(-1px, 2px) rotate(-1deg); } 60% { transform: translate(-3px, 1px) rotate(0deg); } 70% { transform: translate(3px, 1px) rotate(-1deg); } 80% { transform: translate(-1px, -1px) rotate(1deg); } 90% { transform: translate(1px, 2px) rotate(0deg); } 100% { transform: translate(1px, -2px) rotate(-1deg); } }

        #start-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; }
        .mc-btn { background: #727272; border: 4px solid #fff; padding: 15px 30px; font-size: 24px; color: white; font-family: 'VT323', monospace; cursor: pointer; box-shadow: inset 4px 4px #aaa, inset -4px -4px #444; text-transform: uppercase; margin-top: 20px; }
        
        .confetti { position: fixed; top: 50%; left: 50%; z-index: 999; animation: explode-particle 1s ease-out forwards; pointer-events: none; font-size: 30px;}
        @keyframes explode-particle { 0% { transform: translate(0,0) scale(1); opacity: 1; } 100% { transform: translate(var(--tx), var(--ty)) scale(0.5) rotate(720deg); opacity: 0; } }
    </style>
</head>
<body>
    <div class="stars"></div>

    <div id="start-overlay">
        <h1 style="text-shadow: 4px 4px #000; font-size: 40px; margin-bottom:10px;">Andyçš„ä¸–ç•Œ</h1>
        <p style="opacity: 0.8; font-size: 16px;">ç‚¹å‡»æŒ‰é’®æ¿€æ´»å£°éŸ³</p>
        <button class="mc-btn" onclick="startGame()">å¼€å§‹å†’é™©</button>
    </div>

    <audio id="bgm" loop><source src="https://raw.githubusercontent.com/kurisubrooks/minecraft-sounds/master/sounds/music/game/calm1.ogg" type="audio/ogg"></audio>
    <audio id="sfx-levelup"><source src="https://raw.githubusercontent.com/kurisubrooks/minecraft-sounds/master/sounds/random/levelup.ogg" type="audio/ogg"></audio>
    <audio id="sfx-explode"><source src="https://raw.githubusercontent.com/kurisubrooks/minecraft-sounds/master/sounds/random/explode.ogg" type="audio/ogg"></audio>
    <audio id="sfx-hit"><source src="https://raw.githubusercontent.com/kurisubrooks/minecraft-sounds/master/sounds/damage/hit1.ogg" type="audio/ogg"></audio>
    <audio id="sfx-fuse"><source src="https://raw.githubusercontent.com/kurisubrooks/minecraft-sounds/master/sounds/random/fuse.ogg" type="audio/ogg"></audio>
    <audio id="sfx-click"><source src="https://raw.githubusercontent.com/kurisubrooks/minecraft-sounds/master/sounds/random/click.ogg" type="audio/ogg"></audio>

    <div class="ui-container" id="uiLayer">
        <div class="card">
            <div class="mute-btn" onclick="toggleMute()">ğŸ”Š</div>
            <h2>Andyçš„èƒŒåŒ…</h2>
            <div id="rankBadge" class="rank-badge">åŠ è½½ä¸­...</div>
            <div class="slot" onclick="clickCoin()"><div class="coin-icon" id="icon">ğŸª™</div></div>
            <div class="label">å½“å‰æ‹¥æœ‰å¸</div>
            <div id="totalDisplay" class="total">...</div>
            <div class="status-bar"><div id="light" class="light online"></div><span id="connStatus">æ­£åœ¨åŒæ­¥æ•°æ®...</span></div>
            <div id="statusMsg" class="message"></div>
        </div>
    </div>

    <div class="stage">
        <div id="steve" class="actor-steve breathe">
            <div class="s-head"></div><div class="s-hair"></div>
            <div class="s-body"></div><div class="s-pants"></div>
            <div class="s-sword">ğŸ—¡ï¸</div> 
        </div>
        
        <div id="creeper" class="actor-creeper patrol">
            <div class="c-head"><div class="c-face"></div></div>
            <div class="c-body"></div>
            <div class="c-legs"><div class="c-leg" style="left:0"></div><div class="c-leg" style="right:0"></div></div>
        </div>

        <div id="pig" class="actor-pig">
            <div class="p-head"><div class="p-nose"></div></div>
            <div class="p-body"></div>
            <div class="p-leg" style="left:0"></div><div class="p-leg" style="left:25px"></div>
        </div>

        <div id="zombie" class="actor-zombie">
            <div class="z-head"></div>
            <div class="z-body"></div><div class="z-arms"></div>
            <div class="z-legs"><div class="z-leg" style="left:0"></div><div class="z-leg" style="right:0"></div></div>
        </div>
    </div>

    <div class="ground"></div>

    <script>
        const BIN_ID = '695f1cbed0ea881f405c1aab'; 
        const API_KEY = '$2a$10$pSEOl/63AtvEMUqQopzGeuhVgcRcfXSz5L8lyQdZZHZM66zdYKI0O'; 
        const BASE_URL = `https://api.jsonbin.io/v3/b/${BIN_ID}`;
        
        const uiLayer = document.getElementById('uiLayer');
        const totalDisplay = document.getElementById('totalDisplay');
        const statusMsg = document.getElementById('statusMsg');
        const connStatus = document.getElementById('connStatus');
        const rankBadge = document.getElementById('rankBadge');
        const steve = document.getElementById('steve');
        const creeper = document.getElementById('creeper');
        
        const bgm = document.getElementById('bgm');
        const sfxLevelUp = document.getElementById('sfx-levelup');
        const sfxExplode = document.getElementById('sfx-explode'); 
        const sfxHit = document.getElementById('sfx-hit'); 
        const sfxFuse = document.getElementById('sfx-fuse'); 
        const sfxClick = document.getElementById('sfx-click');
        
        let isMuted = false;
        let lastCoins = null;
        let isAnimating = false;

        const RANKS = [
            { limit: 0, title: "ğŸªµ æ–°æ‰‹ä¼æœ¨å·¥" },
            { limit: 50, title: "ğŸª¨ ç†Ÿç»ƒé‡‡çŸ³åŒ " },
            { limit: 150, title: "âš”ï¸ é“ç”²å«å£«" },
            { limit: 300, title: "ğŸ† é»„é‡‘é¢†ä¸»" },
            { limit: 500, title: "ğŸ’ é’»çŸ³å¤§ç¥" },
            { limit: 1000, title: "ğŸ² æœ«å½±å± é¾™è€…" }
        ];

        function startGame() {
            document.getElementById('start-overlay').style.display='none';
            checkDayNight();
            try {
                bgm.load();
                bgm.volume = 0.4;
                bgm.play().catch(e => console.log("è¯·ç‚¹å‡»å±å¹•æ’­æ”¾å£°éŸ³"));
                sfxLevelUp.load(); sfxExplode.load(); sfxHit.load();
            } catch(e){}

            syncData();
            setInterval(syncData, 60000);
        }

        async function syncData() {
            if(isAnimating) return;
            connStatus.innerText = "æ­£åœ¨åŒæ­¥...";
            
            try {
                let res = await fetch(BASE_URL + '/latest', { headers: { 'X-Master-Key': API_KEY } });
                let data = await res.json();
                let cloudCoins = data.record.coins || 0;

                if (lastCoins === null) {
                    lastCoins = parseInt(localStorage.getItem('andy_last_seen_coins'));
                    if(isNaN(lastCoins)) lastCoins = cloudCoins; 
                }

                if (cloudCoins > lastCoins) {
                    let diff = cloudCoins - lastCoins;
                    playAttackSequence(diff, cloudCoins);
                } else if (cloudCoins < lastCoins) {
                    let diff = lastCoins - cloudCoins;
                    playExplodeSequence(diff, cloudCoins);
                } else {
                    connStatus.innerText = "æ•°æ®å·²åŒæ­¥";
                    totalDisplay.innerText = cloudCoins;
                    updateRank(cloudCoins);
                }
                
                if(cloudCoins !== lastCoins) {
                    localStorage.setItem('andy_last_seen_coins', cloudCoins);
                }

            } catch (error) {
                console.error(error);
                connStatus.innerText = "è¿æ¥ä¸­..."; 
            }
        }

        function playAttackSequence(amount, finalCoins) {
            isAnimating = true;
            uiLayer.style.opacity = '0'; 
            steve.classList.remove('breathe'); 
            creeper.classList.remove('patrol'); 
            steve.style.left = "35%"; steve.style.bottom = "80px"; steve.style.transform = "scaleX(1)";
            creeper.style.right = "35%"; creeper.style.bottom = "80px"; creeper.style.transform = "scaleX(1)";
            
            document.querySelector('.s-sword').style.display = 'block'; 

            setTimeout(() => {
                document.querySelector('.s-sword').classList.add('anim-attack');
                playSound('hit');
                setTimeout(() => { creeper.classList.add('anim-hurt'); }, 150);
            }, 500);

            setTimeout(() => {
                creeper.style.display = 'none'; 
                createParticles(100, 'ğŸ’°'); 
                playSound('levelup');
                statusMsg.innerText = `å‡»æ€å¥–åŠ±ï¼+${amount}`;
                statusMsg.style.color = "#00aa00";
            }, 1200);

            setTimeout(() => {
                updateValue(finalCoins);
                resetStage();
            }, 3000);
        }

        function playExplodeSequence(amount, finalCoins) {
            isAnimating = true;
            uiLayer.style.opacity = '0';
            steve.style.left = "-100px"; 
            creeper.classList.remove('patrol');
            creeper.style.right = "45%"; creeper.style.bottom = "50px"; creeper.style.transition = "all 0.5s";

            setTimeout(() => {
                playSound('fuse');
                creeper.classList.add('anim-swell'); 
            }, 500);

            setTimeout(() => {
                creeper.style.opacity = '0';
                document.body.classList.add('shake'); 
                createParticles(50, 'â¬›'); 
                createParticles(50, 'ğŸŸ¥'); 
                playSound('explode');
                statusMsg.innerText = `é­é‡çˆ†ç‚¸ï¼æŸå¤± ${amount}`;
                statusMsg.style.color = "#8b0000";
            }, 2500);

            setTimeout(() => {
                document.body.classList.remove('shake');
                updateValue(finalCoins);
                resetStage();
            }, 4000);
        }

        function resetStage() {
            uiLayer.style.opacity = '1';
            steve.style = ""; steve.classList.add('breathe');
            document.querySelector('.s-sword').style.display = 'none';
            document.querySelector('.s-sword').classList.remove('anim-attack');
            creeper.style = ""; creeper.style.display = 'block'; creeper.style.opacity = '1';
            creeper.classList.remove('anim-hurt'); creeper.classList.remove('anim-swell');
            creeper.classList.add('patrol');
            isAnimating = false;
            lastCoins = parseInt(totalDisplay.innerText);
        }

        function updateValue(coins) { totalDisplay.innerText = coins; updateRank(coins); }

        function createParticles(count, char) {
            for (let i = 0; i < count; i++) {
                const el = document.createElement('div');
                el.classList.add('confetti');
                el.innerText = char;
                const angle = Math.random() * 360;
                const dist = 50 + Math.random() * 100;
                const tx = Math.cos(angle * Math.PI / 180) * dist + 'vw';
                const ty = Math.sin(angle * Math.PI / 180) * dist + 'vh';
                el.style.setProperty('--tx', tx);
                el.style.setProperty('--ty', ty);
                document.body.appendChild(el);
                setTimeout(() => el.remove(), 1000);
            }
        }

        function checkDayNight() {
            const hour = new Date().getHours();
            const pig = document.getElementById('pig');
            const zombie = document.getElementById('zombie');
            if (hour >= 18 || hour < 6) {
                document.body.classList.add('night');
                pig.style.display = 'none'; zombie.style.display = 'block'; 
            } else {
                document.body.classList.remove('night');
                pig.style.display = 'block'; zombie.style.display = 'none'; 
            }
        }
        function updateRank(coins) {
            let currentTitle = RANKS[0].title;
            for(let rank of RANKS) { if(coins >= rank.limit) currentTitle = rank.title; }
            rankBadge.innerText = currentTitle;
        }
        function clickCoin() {
            if(!isMuted) { sfxClick.currentTime = 0; sfxClick.play().catch(e=>{}); }
            if(navigator.vibrate) navigator.vibrate(20);
        }
        function toggleMute() {
            isMuted = !isMuted;
            bgm[isMuted ? 'pause' : 'play']();
            document.querySelector('.mute-btn').innerText = isMuted ? 'ğŸ”‡' : 'ğŸ”Š';
        }
        function playSound(type) {
            if(isMuted) return;
            try {
                if(type === 'levelup') { sfxLevelUp.currentTime=0; sfxLevelUp.play(); }
                if(type === 'explode') { sfxExplode.currentTime=0; sfxExplode.play(); }
                if(type === 'hit') { sfxHit.currentTime=0; sfxHit.play(); }
                if(type === 'fuse') { sfxFuse.currentTime=0; sfxFuse.play(); }
            } catch(e){}
        }
    </script>
</body>
</html>
