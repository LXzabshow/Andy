<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‡‘å¸å¥–åŠ±ç«™</title>
    <style>
        body { font-family: 'Rounded Mplus 1c', sans-serif; background-color: #f0f4f8; text-align: center; padding: 20px; }
        .card { background: white; border-radius: 20px; padding: 30px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); margin-top: 50px; }
        h1 { color: #333; font-size: 24px; }
        .coin-icon { font-size: 60px; margin: 20px 0; display: block; }
        .total { font-size: 40px; color: #ffb700; font-weight: bold; }
        .message { color: #666; margin-top: 10px; font-size: 16px; }
        .anim-add { color: #2ecc71; font-weight: bold; font-size: 20px; animation: pop 0.5s ease; }
        @keyframes pop { 0% { transform: scale(0); } 80% { transform: scale(1.2); } 100% { transform: scale(1); } }
        .btn { margin-top: 30px; padding: 10px 20px; background: #3498db; color: white; border: none; border-radius: 10px; cursor: pointer; }
    </style>
</head>
<body>

    <div class="card">
        <div class="coin-icon">ğŸ’°</div>
        <div>å½“å‰é‡‘å¸æ€»æ•°</div>
        <div id="totalDisplay" class="total">0</div>
        <div id="statusMsg" class="message"></div>
    </div>

    <script>
        // 1. è·å– URL ä¸­çš„å‚æ•°
        const params = new URLSearchParams(window.location.search);
        const addAmount = parseInt(params.get('add')); // è·å–è¦å¢åŠ çš„é‡‘å¸æ•°
        const transId = params.get('id'); // è·å–å”¯ä¸€äº¤æ˜“IDï¼ˆé˜²æ­¢åˆ·æ–°é‡å¤åŠ ï¼‰
        
        // 2. è·å–æœ¬åœ°å­˜å‚¨çš„æ€»é‡‘å¸æ•°
        let currentCoins = parseInt(localStorage.getItem('my_coins')) || 0;
        const totalDisplay = document.getElementById('totalDisplay');
        const statusMsg = document.getElementById('statusMsg');

        // 3. æ ¸å¿ƒé€»è¾‘
        if (addAmount && transId) {
            // æ£€æŸ¥è¿™ä¸ª ID æ˜¯å¦å·²ç»ä½¿ç”¨è¿‡
            if (localStorage.getItem('trans_' + transId)) {
                statusMsg.innerText = "âš ï¸ è¿™æ¬¡å¥–åŠ±å·²ç»é¢†å–è¿‡å•¦ï¼";
            } else {
                // æ‰§è¡ŒåŠ æ³•
                currentCoins += addAmount;
                // ä¿å­˜æ–°æ€»æ•°
                localStorage.setItem('my_coins', currentCoins);
                // æ ‡è®°è¿™ä¸ª ID å·²ä½¿ç”¨
                localStorage.setItem('trans_' + transId, 'used');
                
                statusMsg.innerHTML = `<span class="anim-add">+${addAmount} é‡‘å¸åˆ°è´¦ï¼åšå¾—å¥½ï¼ğŸ‰</span>`;
            }
        } else {
            statusMsg.innerText = "æŸ¥çœ‹é‡‘å¸ä½™é¢";
        }

        // 4. æ›´æ–°é¡µé¢æ˜¾ç¤º
        totalDisplay.innerText = currentCoins;
    </script>
</body>
</html>
